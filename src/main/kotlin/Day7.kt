package de.winkler


fun main() {

    var input2 = """
        .......S.......
        ...............
        .......^.......
        ...............
        ......^.^......
        ...............
        .....^.^.^.....
        ...............
        ....^.^...^....
        ...............
        ...^.^...^.^...
        ...............
        ..^...^.....^..
        ...............
        .^.^.^.^.^...^.
        ...............

    """.trimIndent()
    var input = """
        ......................................................................S......................................................................
        .............................................................................................................................................
        ......................................................................^......................................................................
        .............................................................................................................................................
        .....................................................................^.^.....................................................................
        .............................................................................................................................................
        ....................................................................^.^.^....................................................................
        .............................................................................................................................................
        ...................................................................^.....^...................................................................
        .............................................................................................................................................
        ..................................................................^.^.^.^.^..................................................................
        .............................................................................................................................................
        .................................................................^.^.^.^...^.................................................................
        .............................................................................................................................................
        ................................................................^.^.^.^...^.^................................................................
        .............................................................................................................................................
        ...............................................................^.^.^.^.....^.^...............................................................
        .............................................................................................................................................
        ..............................................................^...^.......^.^.^..............................................................
        .............................................................................................................................................
        .............................................................^.^.^.^.^.^.^...^.^.............................................................
        .............................................................................................................................................
        ............................................................^.^.^.^...^.^.^...^.^............................................................
        .............................................................................................................................................
        ...........................................................^.^.^.....^.^.^.^.^.^.^...........................................................
        .............................................................................................................................................
        ..........................................................^...^.^.^...^.^...^.^.^.^..........................................................
        .............................................................................................................................................
        .........................................................^.^.^.^.^...^.^.^...^.^.^.^.........................................................
        .............................................................................................................................................
        ........................................................^.^.^.^.^...........^.^.^.^.^........................................................
        .............................................................................................................................................
        .......................................................^.......^.^.^.^.^.^.^.^.^.^.^.^.......................................................
        .............................................................................................................................................
        ......................................................^.^...^.^.^...^.^.^...^...^.^...^......................................................
        .............................................................................................................................................
        .....................................................^.....^...^.^.^.^.^.^.....^.....^.^.....................................................
        .............................................................................................................................................
        ....................................................^...^.^.^.^...^...^.^.^.^.^...^.^.^.^....................................................
        .............................................................................................................................................
        ...................................................^.^...^.^.^...^.^...^.^.^.^.^.^.^.^...^...................................................
        .............................................................................................................................................
        ..................................................^...^.^.^.....^.......^.^.^.^.^...^.^.^.^..................................................
        .............................................................................................................................................
        .................................................^.^.^.^.^.^...^.^...^.^.^.^.........^.^.^.^.................................................
        .............................................................................................................................................
        ................................................^.^.^.^.^...^.^...^.^.^.^.^...^.^...^.^...^.^................................................
        .............................................................................................................................................
        ...............................................^.^...^.^...........^...^.^.^.^.^...^.^.^.^...^...............................................
        .............................................................................................................................................
        ..............................................^.......^...^.....^.^...^.^.^.^.^.^.^.^.^...^.^.^..............................................
        .............................................................................................................................................
        .............................................^.^...^...^...^...^.....^...^.^.^.^.^...^.^.^.^.^.^.............................................
        .............................................................................................................................................
        ............................................^.^.^.^.^.^...^.^...^.^...^...^.^.^...^.^.^.^.....^.^............................................
        .............................................................................................................................................
        ...........................................^.^.....^.^.^...^.^.^.^...^.^.^.^.^.....^.^.^.^.^...^.^...........................................
        .............................................................................................................................................
        ..........................................^...^.^.^.^...^.^.^.^...^.....^...^.^.^.....^.^...^.^...^..........................................
        .............................................................................................................................................
        .........................................^.^...^.^.^.^.^.^.^.^.^.......^.....^.^.^.^.......^.^.^.^.^.........................................
        .............................................................................................................................................
        ........................................^...^.^...^...^.^.^...^...^...^.^.^.^.^.^.^...^.^.^.^.^...^.^........................................
        .............................................................................................................................................
        .......................................^.^.^.^...^.^.^.^.^.^...^.^.^.^.^.^.......^.^.^.^.^.^...^.^.^.^.......................................
        .............................................................................................................................................
        ......................................^.^.^...^.^.....^.^.^...^.^.^...^.^.^...^.^...^.^.......^.....^.^......................................
        .............................................................................................................................................
        .....................................^.^.......^.^...^...^.^...^.^.^.^.^.....^.^.^...^.^.^...^.^.......^.....................................
        .............................................................................................................................................
        ....................................^...^.^.......^.^.^.^.^.^.^.^.......^.^...^...^.^.^.^.^.^.^.^.^.^...^....................................
        .............................................................................................................................................
        ...................................^.^...^.^.^.^.^.....^.^.^.^.^.^.^.....^.^.^.^.^.^.^.......^.^.^.^.^.^.^...................................
        .............................................................................................................................................
        ..................................^.....^...^.^.....^.^...^.^.....^...^.....^.....^.^.^.^.^.......^.^.^...^..................................
        .............................................................................................................................................
        .................................^.....^.^.^.^.^...^.^.^...^...^...^.^.^.^.^...^.^.^.^.^.^.....^.^.^.^.^.^.^.................................
        .............................................................................................................................................
        ................................^.^.^.^.^.^.^.^.....^.^.^.^.^.^...^.^.^.^.^.^.^.^...^.^...^.^.^...^.....^.^.^................................
        .............................................................................................................................................
        ...............................^...^.^...^.^.^.^.^.^.^.^.^...^.^.^.^...^.^.^.^.^.^.^...^.^...^.^.....^.^.^.^.^...............................
        .............................................................................................................................................
        ..............................^.^.^.^.^.^.^...^.^.....^.....^.^.^...^.^.^.^.^.^.^.^.^.^.^...^.^.^.^.^.^...^...^..............................
        .............................................................................................................................................
        .............................^.^.^.^.^.^.^.^...^...^.^.^...^...^...^.^...^.^...^...^.^.^.^.^.^.^...^.^.^.^.^.^.^.............................
        .............................................................................................................................................
        ............................^.^...^.^.^.^.^.^.....^.^.^...^.....^.^...^.^...^.^.......^.^.^.^.^.^.^.^.^.^.^.^.^.^............................
        .............................................................................................................................................
        ...........................^.^.^.^.^.^.^.....^...^.^.....^.^...^.^...^.....^.^.^...^.^.^.^.^.^.^.....^...^.^.^.^.^...........................
        .............................................................................................................................................
        ..........................^.^.^.^.^.^...^.^.^.^.^.^.^.^.^.^.^.....^.......^.^...^.^.^.^.^.^.^.^.........^.^.^.^...^..........................
        .............................................................................................................................................
        .........................^.^.^.^.^.......^.^.^.^.^.^.^...^.^.......^.^.^.....^.^.^.^.^...^.^.^.^.^.^...^.^.^.^.^...^.........................
        .............................................................................................................................................
        ........................^.^.^.^.^.^...^...^...^.^...^...^.^.^...^...^.^.^.^.......^.....^.^...^.^.^.....^.^...^.^...^........................
        .............................................................................................................................................
        .......................^.^.^.^...^.^.^.^.^.^.^.^.^.^.^.^...^.^.^.^...^.....^...^...^.^.......^.^.^.....^.^.^.^...^.^.^.......................
        .............................................................................................................................................
        ......................^...^.^.^.^.^.^.^.^...^...^.^.^.^.^...^.......^.^.....^.^.....^.^.^...^.^.^.^.^...^.^...^.^.^...^......................
        .............................................................................................................................................
        .....................^...^.^.^.^.^.^.^.^.....^.^.....^.^.^.^...^.^.^.^.^.^.^.....^.^...^.....^.^.....^.^.^.^...^.......^.....................
        .............................................................................................................................................
        ....................^.^.^.^...^.....^...^.^.^.^...^.^.^.....^.^.^.^.^.^.^.^.^.^.^...^.^.^.^.^...^.^.^...^.^.....^.^...^.^....................
        .............................................................................................................................................
        ...................^.^.^.^...^...^.^.....^.^...^.^.......^.^.^.^.^.^...^.^...^.^.^.^.^...^.^.^.^...^.^.^.....^.^...^.^.^.^...................
        .............................................................................................................................................
        ..................^.....^...^.^...^.^.^.^.^.^...^.^.^.^.^.^.^.^...^...^.^.....^.^.^.^.^.^...^.^...^.^...^.^.^.^.^.^.^...^.^..................
        .............................................................................................................................................
        .................^...^.^.^.^...^.^.^...^...^.^.^.^.^...^.^.^.^.^.^.^.^.....^.^.....^.^.....^...^.^.^.^.^.^...^.^.^.^.....^.^.................
        .............................................................................................................................................
        ................^.^...^.^.^.^.^.^.^...^.^.....^...^.^.....^.^.^.^.^.........^.^.......^...^.^.^.^.^.^.......^.....^...^.^...^................
        .............................................................................................................................................
        ...............^.^...^.^.^.^.^.^.....^.....^.^.....^.^.^.^.....^...^.^.^...^...^.^.^.^...^...^.^.^.^.^.^...^...^...^...^.^.^.^...............
        .............................................................................................................................................
        ..............^.^.^.^...^.^.^.^.^.^.^...^...^.^.^.^.........^.^...^.....^.^.^.^.^.^.........^.^.^.^...^.^.^.^.^...^.^...^.^.^.^..............
        .............................................................................................................................................
        .............^.^.^.^...^.^.^.^...^.^.......^.^.^.^...^.^.........^.....^.^.^.^.^.^.^.^.^.^.^...^...^.^.^.^.^...^.^...^.^.....^.^.............
        .............................................................................................................................................
        ............^.^.^.^.^.^.^.^.^.^.^.^.^...^.^.^.....^...^.^.^.^.^.^.^.^.^.^.^.^.^...^.^.^...^.^...^.^...^.^.^...^.^.^.^.^...^.....^............
        .............................................................................................................................................
        ...........^.^.^.^.^...^.^.^.^...^.^.^.^...^.....^.........^.^...^...^...^.^...^.^.^.^.^.^.^.^.^.^.^...^...^...^.^.^.^.^.^.^.^.^.^...........
        .............................................................................................................................................
        ..........^.^.^.^...^...^.^...^...^.^.^...^.^.^.^.^.^...^.^...^...^.........^.^.^.^.^.^.^.^.^...^.^.^.^.^.^.^...^...^.^.^...^...^.^..........
        .............................................................................................................................................
        .........^.^.^...^.^...^...^...^.^.^...^.^.^.^...^...^.^.^.^.^.^.^.^.^.^.^.^.^.^.^...^.^.^.^.^.^.......^.^.^.^...^.^.^.^.^.^...^...^.........
        .............................................................................................................................................
        ........^.^.^.^.^.....^.^.^.^.^.^.^.^...^.^.^.^.^.....^.^.^.^.^.^...^.^.^.^...^.....^.^...^.^.^...^.^.^.^...^.^.^.....^.^.^.^.^...^.^........
        .............................................................................................................................................
        .......^.^.^.^.^.^...^.^...^.^...^.....^.^...^.^...^.^...^.^.^.^.^.^...^...^.^.^.^.^.^.....^.^.^...^.^.^.^...^...^...^.^.^.^.^...^.^.^.......
        .............................................................................................................................................
        ......^.^.^.^.^.^...^...^.^.^.^.^.^.^.^.^.^.^...^.^...^...^.^.^.....^.........^.^.^.^.^.^.^.^.^.^.....^.^...^...^.^.^.^.^.^.^.^.^.....^......
        .............................................................................................................................................
        .....^...^...^.^.^.^.^.^.^.^.^.^.^.^.^.^...^...^...^.^.^.^.^.....^...^.^.^.....^.^.^.^.^.^.^.^.^.....^...^.^.^.^.^.^...^.^.^.^.....^.^.^.....
        .............................................................................................................................................
        ....^.^.^.^.^...^.^.....^.^...^...^.^.^.^.^...^.^.^.^.^.....^.^.^.^...^.^...^...^.^.^.^...^.^.....^.^.^.^.....^.^.^...^.......^.^.^.^...^....
        .............................................................................................................................................
        ...^.^...^.^.^.^.^...^.^.^.^.^.^.^.^.^.^.^.^...^.^.^.....^.^.^...^.^...^.....^.^.^.^.^.^.^.^.^...^...^.^.^.^...^.^...^.^...^.^...^.^.^.^.^...
        .............................................................................................................................................
        ..^.^.^...^.^.....^.^.^...^.^...^.^.^.^.^.^.^.^.^.^.^.^.^.^...^.^...^.^.^.^.^.....^.....^.^.^.^.....^...^...^.^.^.....^.^.^.^.^.^...^...^.^..
        .............................................................................................................................................
        .^.^.^.^.^...^.^.^.^.^.^.^.^.^.....^.....^.^...^.^.^.^.^...^.^...^.^.^...^.^...^...^.^.^.^.^.^...^.^.^...^.^...^.^.^.^...^.^...^.^.^.^.^.^.^.
        .............................................................................................................................................
    """.trimIndent()

    var lines = input.lines()
    var currentBeamPos = mutableSetOf<TimeLine>()
    for (i in 0..lines[0].length - 1) {
        if (lines[0][i] == 'S') {
            currentBeamPos.add(TimeLine(i, 1))
        }
    }
    for (line in input.lines()) {
        var nextBeamPosition = currentBeamPos.toMutableSet()
        for (i in 0..<line.length) {
            if (line[i] == '^' && currentBeamPos.contains(i)) {
                var t = nextBeamPosition.remove(i)
                nextBeamPosition.add(i - 1, t!!.count)
                nextBeamPosition.add(i + 1, t.count)
            }
        }
        currentBeamPos = nextBeamPosition
    }

    var total = 0L;
    for (curr in currentBeamPos) {
        total += curr.count
    }
    println(total)
}

fun MutableSet<TimeLine>.contains(pos: Int): Boolean {
    for (timeline in this) {
        if (timeline.pos == pos) {
            return true
        }
    }
    return false
}

fun MutableSet<TimeLine>.remove(pos: Int): TimeLine? {
    for (timeline in this) {
        if (timeline.pos == pos) {
            this.remove(timeline)
            return timeline
        }
    }
    return null
}

fun MutableSet<TimeLine>.add(pos: Int, count: Long) {
    for (timeline in this) {
        if (timeline.pos == pos) {
            timeline.count += count
            return
        }
    }
    this.add(TimeLine(pos, count))

}

class TimeLine(var pos: Int, var count: Long) {
}